language: node_js
node_js:
- '6'
before_install:
- if [ ! -z "$ARTIFACTS_BUCKET" ] && [ ! -z "ARTIFACTS_KEY" ] && [ ! -z "ARTIFACTS_SECRET" ] ; then export UPLOAD_ARTIFACT=yes ; else echo artifact uploading is disabled; fi
install:
  - npm install -g npm@5.3.0 && npm -v
  - npm install --no-optional --no-save --no-update-dependencies
  - if [ ! -z "$UPLOAD_ARTIFACT" ]; then curl -sL https://raw.githubusercontent.com/travis-ci/artifacts/master/install | bash; fi
script:
  - npm run package
after_success:
  - if [ ! -z "$UPLOAD_ARTIFACT" ] ; then artifacts upload --target-paths /${TRAVIS_REPO_SLUG}/${TRAVIS_BUILD_NUMBER}/NODE-${TRAVIS_NODE_VERSION} dist/app.zip ; fi
  - if [ ! -z "$UPLOAD_ARTIFACT" ] && [ ! -z "$TRAVIS_PULL_REQUEST_SLUG" ] ; then npm run dpat -- travis pr-comment . --s3target /${TRAVIS_REPO_SLUG}/${TRAVIS_BUILD_NUMBER}/NODE-${TRAVIS_NODE_VERSION}; fi
deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: OXrL4Hn3fd+QKFyiKFQWlr2v8XKEy9kWuhGXTgWRPsDK7nkc38vCBB9nikLrjS4gj7FiZsjC1MYRxoXTlLlNshpXduOITdvL03mfWYnDlGUk7ybFcYemBZ5yFgEMXR7fnvE9Wk/Sv11dVoNHxSHwpLnxcNKO3VUBD0yHeYgvjGwVA/7xwmmt3lSqb8w3BHv7TNlF4i/qN+rJieg01hXMvjGa851rM7PPdEtWAxoIP4e0gvtFOrGExp5YXEHq40hSSOn1r2DM3ESvxZnyuqVGcYI2p+ouIc4JkNFp8ExJVH4eD2xCkKB7+JzFzbOGsoHgRROr5IB5qFf53jSynVQHdbvMeLejzGIaI+kmvYxOH62ysq3YjhYbv0V2oh3e6lJDkFjGSnHia00+TGGKP/Zf8So2y+BUAXzAy7c3u8dYGApY/QvWwyvheACskn2wJ81W8V/o2+c9b/TyV3IPNy0YjnXzVE5kTzcs/D/KUvQMjnN0o+rHkFTBw31IWtOZ6FR61+Gdhr60spwkRa/5xiUg0V5WKd2pfgkZ/L+rjFmEfvIphEpm98WIa4ktNFM8tc8DIqEOWvgO94iRaCy2SxMkhpytyEWcy0Eq7SqHw51qod3VCVeiEd07GBtdF/taKcobD/UNUc7Yy3AYwvU4mR6gPeow8vdQEysI8AUFjHCg6G8=
  file: dist/app.zip
  on:
    repo: DeskproApps/trello
    tags: true
